<!DOCTYPE html>
<html>
<head>
<title>Appcanary</title>
<meta content='&lt;a href="https://appcanary.com"&gt;Appcanary&lt;/a&gt; makes sure you never run vulnerable software in your apps.' name='description'>
<meta charset='utf-8'>
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<meta content='IE=edge' http-equiv='X-UA-Compatible'>
<meta content='True' name='HandheldFriendly'>
<meta content='Appcanary' property='og:site_name'>
<meta content='website' property='og:type'>
<meta content='&lt;a href="https://appcanary.com"&gt;Appcanary&lt;/a&gt; makes sure you never run vulnerable software in your apps.' property='og:description'>
<meta content='http://blog.appcanary.com/' property='og:url'>
<meta content='summary' name='twitter:card'>
<meta content='&lt;a href="https://appcanary.com"&gt;Appcanary&lt;/a&gt; makes sure you never run vulnerable software in your apps.' name='twitter:description'>
<meta content='http://blog.appcanary.com/' name='twitter:url'>
<link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
<link href="/images/favicon.ico" rel="icon" type="image/ico" />
<link href="stylesheets/application.css" rel="stylesheet" />
<script src="//use.typekit.net/dkz5zwp.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>

</head>
<body class='post-template home-post-template nav-closed'>
<div class='topbar'></div>
<div class='nav'>
<h3 class='nav-title'>Menu</h3>
<a class='nav-close' href='#'>
<span class='hidden'>Close</span>
</a>
<ul>
<li class='nav-home nav-current' role='presentation'>
<a href='/'>Home</a>
</li>
<li class='nav-archive' role='presentation'>
<a href='archive.html'>Archive</a>
</li>
<li class='nav-github' role='presentation'>
<a href='https://github.com/appcanary'>Github</a>
</li>
</ul>
<a class='subscribe-button icon-feed' href='/feed.xml'>Subscribe</a>
</div>
<span class='nav-cover'></span>

<div class='site-wrapper'>
<header class='main-header no-cover'>
<nav class='main-nav overlay clearfix'>
</nav>
<div class='vertical'>
<div class='main-header-content inner'>
<a class='appcanary-logo' href='/'>
<img alt="Appcanary" src="images/appcanary.png" />
</a>
<h2 class='page-description'><a href="https://appcanary.com">Appcanary</a> makes sure you never run vulnerable software in your apps.</h2>
<div class='more-icons'>
<a alt='Github' href='https://github.com/appcanary' title='Github'>
<i class='fa fa-github-square'></i>
</a>
<a alt='Archive' href='/archive.html' title='Archive'>
<i class='fa fa-archive'></i>
</a>
<a alt='Feed' href='/feed.xml' title='Feed'>
<i class='fa fa-rss-square'></i>
</a>
</div>
</div>
</div>
<a class='scroll-down icon-arrow-left' data-offset='-45' href='#content'>
<span class='hidden'>Scroll Down</span>
</a>
</header>

<main class='content' id='content' role='main'>
<div class='extra-pagination inner'>
<nav class='pagination' role='pagination'>
<span class='page-number'>Page 1 of 2</span>
<a class="older-posts" href="page/2/">Older Posts →</a>
</nav>

</div>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/encrypt-or-compress.html">Should you encrypt or compress first?</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>Imagine this:</p>

<p>You work for a big company. Your job is pretty boring. Frankly, your talents are wasted writing boilerplate code for an application whose only users are three people in accounting who can&rsquo;t stand the sight of you.</p>

<p>Your real passion is security. You read <a href="www.reddit.com/r/netsec">r/netsec</a> every day and participate in bug bounties after work. For the past three months, you&rsquo;ve been playing a baroque stock trading game that you&rsquo;re winning because you found a heap-based buffer overflow and wrote some AVR shellcode to help you pick stocks.</p>

<p>Everything changes when you discover that what you had thought was a video game was actually a cleverly disguised recruitment tool. Mont Piper, the best security consultancy in the world, is hiring &mdash; and you just landed an interview!</p>

<p>A plane ride and an Uber later, you&rsquo;re sitting across from your potential future boss: a slightly sweaty hacker named Gary in a Norwegian metal band t-shirt and sunglasses he refuses to take off indoors.</p>

<p>You blast through the first part of the interview. You give a great explanation of the difference between privacy and anonymity. You describe the same origin policy in great detail, and give three ways an attacker can get around it. You even whiteboard the intricacies of <code>__fastcall</code> vs <code>__stdcall</code>. Finally, you&rsquo;re at the penultimate section, protocol security.</p>

<p>Gary looks you in the eyes and says: &ldquo;You&rsquo;re designing a network protocol. Do you compress the data and then encrypt it, or do you encrypt and then compress?&rdquo; And then he clasps his hands together and smiles to himself.</p>

<p>A classic security interview question!</p>

<hr>

<p>Take a second and think about it. </p>

<p>At a high level, compression tries to use patterns in data in order to reduce its size. Encryption tries to shuffle data in such a way that without the key, you can&rsquo;t find any patterns in the data at all. </p>

<p>Encryption produces output that appears random: a jumble of bits with a lot of entropy. Compression doesn&rsquo;t really work on data that appears random &mdash; entropy can actually be thought of as a measure of how &ldquo;compressable&rdquo; some data is.</p>

<p>So if you encrypt first, your compression will be useless. The answer must be to compress first! Even StackOverflow <a href="http://stackoverflow.com/questions/4676095/when-compressing-and-encrypting-should-i-compress-first-or-encrypt-first">thinks so</a>.</p>

<hr>

<p>You start to say this to Gary, but you stop mid-sentence. An attacker sniffing encrypted traffic doesn&rsquo;t get much information, but they do get to learn the length of messages. If they can somehow use that to learn more information about the message, maybe they can foil the encryption.</p>

<p>You start explaining this to Gary, and he interrupts you &mdash; &ldquo;Oh you mean like the <a href="https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2012/september/details-on-the-crime-attack/">CRIME</a> attack?&rdquo;</p>

<p>&ldquo;Yes!&rdquo; you reply. You start to recall the details of it. All the SSL attacks with catchy names are mixed together in your mind, but you&rsquo;re pretty sure that&rsquo;s the one. They controlled some information that was being returned by the server, and used that to generate guesses for a secret token present in the response. The response was compressed in such a way that you could validate guesses for the secret by seeing how you affected the length of the compressed message. If the secret was <code>AAAA</code> and you guessed <code>AAAA</code>, the compressed-then-encrypted response will be shorter than if you guessed <code>BBBB</code>.</p>

<p>Gary looks impressed. &ldquo;But what if the attacker can&rsquo;t control any of the plaintext in any way? Is this kind of attack still possible?&rdquo; he asks.</p>

<hr>

<p>CRIME was a very cool demonstration of how compress-then-encrypt isn&rsquo;t always the right decision, but my favorite compress-then-encrypt attack was published a year earlier by Andrew M. White, Austin R. Matthews, Kevin Z. Snow, and Fabian Monrose. The paper <a href="http://www.cs.unc.edu/~fabian/papers/foniks-oak11.pdf">Phonotactic Reconstruction of Encrypted VoIP Conversations</a> gives a technique for reconstructing speach from an encrypted VoIP call.</p>

<p>Basically, the idea is this: VoIP compression isn&rsquo;t going to be a generic audio compression algorithm, because we can rely on some assumptions about human speach in order to compress more efficiently. From the paper:</p>

<blockquote>
<p>Many modern speech codecs are based on variants of a well-known speech coding
scheme known as code-excited linear prediction (CELP) [49], which is in turn
based on the source-filter model of speech prediction. The source-filter model
separates the audio into two signals: the excitation or source signal, as
produced by the vocal cords, and the shape or filter signal, which models the
shaping of the sound performed by the vocal tract. This allows for
differentiation of phonemes; for instance, vowels have a periodic excitation
signal while fricatives (such as the [sh] and [f] sounds) have an excitation
signal similar to white noise [53].</p>

<p>In basic CELP, the excitation signal is modeled as an entry
from a fixed codebook (hence code-excited). In some CELP
variants, such as Speex’s VBR (variable bit rate) mode, the codewords can
be chosen from different codebooks depending on the complexity
of the input frame; each codebook contains entries
of a different size. The filter signal is modeled using linear
prediction, i.e., as a so-called adaptive codebook where the
codebook entries are linear combinations of past excitation
signals. The “best” entries from each codebook are chosen
by searching the space of possible codewords in order
to “perceptually” optimize the output signal in a process
known as analysis-by-synthesis [53]. Thus an encoded frame
consists of a fixed codebook entry and gain (coefficient) for
the excitation signal and the linear prediction coefficients for
the filter signal.</p>

<p>Lastly, many VoIP providers (including Skype) use VBR 
codecs to minimize bandwidth usage while maintaining
call quality. Under VBR, the size of the codebook entry,
and thus the size of the encoded frame, can vary based
on the complexity of the input frame. The specification
for Secure RTP (SRTP) [3] does not alter the size of the
original payload; thus encoded frame sizes are preserved
across the cryptographic layer. The size of the encrypted
packet therefore reflects properties of the input signal; it is
exactly this correlation that our approach leverages to model
phonemes as sequences of lengths of encrypted packets.</p>
</blockquote>

<p>That pretty much summarizes the paper. CELP + VBR means that message length is going to depend on complexity. Due to how linear prediction works, more information is needed to encode a drastic change in sound &mdash; like the pause between phonemes! This allows the authors to build a model that can break an <strong>encrypted</strong> audio signal into phonemes: that is, deciding which audio frames belong to which unit of speach.</p>

<p>They then built a classifier that, still only using the packet length information they started with, decides which segmented units of encrypted audio represent which actual phonemes. They then use a language model to correct the previous step&rsquo;s output and segment the phoneme stream into words and then phrases.</p>

<p>The crazy thing is that this whole rigmarole works! They used a metric called <a href="http://www.cs.cmu.edu/~alavie/METEOR/">METEOR</a> and got scores of around .6. This is on a scale where &lt;.5 is considered &ldquo;interpretable by a human.&rdquo; Considering that the threat vector here is a human using this technique to listen in on your encrypted VoIP calls &mdash; that&rsquo;s pretty amazing! </p>

<hr>

<h2>Epilogue</h2>

<p>You end up getting the job, but 6 months later, Mont Piper is sold to a large conglomerate. Gary refuses to trade in his Norwegian metal t-shirts for a button-down and is summarily fired. You now spend your days going on-site to a big bank, &ldquo;advising&rdquo; a team that hates your guts.</p>

<p>But recently, you&rsquo;ve picked up machine learning and found this really cool online game where you try to make a 6-legged robot walk in a 3d physics simulation&hellip;</p>

<hr>

<h4>Paying the Bills</h4>

<p>Vulnerabilities come out every day, and most don&rsquo;t get blog posts like this written about them.</p>

<p>Our product, <a href="https://appcanary.com/?utm_source=blog&amp;utm_medium=web&amp;utm_campaign=compress">Appcanary</a>, monitors your apps and servers, and notifies you whenever a new vulnerability is discovered in a package you rely on. </p>

<p><a href="https://appcanary.com/sign_up?utm_source=blog&amp;utm_medium=web&amp;utm_campaign=compress">Sign up</a> today!</p>

</section>
<footer class='post-meta'>
<a href='/author/max-veytsman.html'>Max Veytsman</a>
<time class='post-date' datetime='2016-06-25'>
25 June 2016
</time>
</footer>
</article>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/debian-support.html">Appcanary now supports Debian!</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>I&rsquo;m excited to announce that Appcanary now fully supports <strong>Debian</strong>. If you
install our agent on a Debian server, we will email you notifications whenever
any package you have installed on your system has a known vulnerability. We track over 24,000 vulnerabilities already!</p>

<p>You can also use our <a href="https://appcanary.com/docs#check-endpoint">Check API</a> to
verify if your Debian server has any vulnerable packages, and our
<a href="https://appcanary.com/docs#create-monitor">Monitor API</a> to register to receive
notifications if a set of Debian packages ever has new vulnerabilities.</p>

<p>If you&rsquo;re not a current user and want to try out Appcanary for Debian, you can
<a href="https://appcanary.com/signup">sign up</a>!</p>

<p>You can always let us know what you think at
<a href="mailto:hello@appcanary.com">hello@appcanary.com</a>.</p>

</section>
<footer class='post-meta'>
<a href='/author/max-veytsman.html'>Max Veytsman</a>
on <a href='/tag/announcements.html'>Announcements</a>, <a href='/tag/product.html'>Product</a>
<time class='post-date' datetime='2016-06-24'>
24 June 2016
</time>
</footer>
</article>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/two-new-apis.html">Two new APIs from Appcanary</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>After the success of our <a href="http://blog.appcanary.com/2016/new-api-centos-support.html">check</a> API, we found that our users told us:</p>

<blockquote>
<p>&ldquo;I love your API so much! But can I use it register the packages my app uses and get emailed if new vulnerabilities that affect me come out? Oh, and it would be nice if I could pragmatically query the servers I have agents running on too!&rdquo;</p>
</blockquote>

<p>So we went ahead and built both.</p>

<h2>The Monitor API</h2>

<p>The &ldquo;Monitor&rdquo; API lets you register a Gemfile or an Ubuntu/CentOS package list to be emailed when new vulnerabilities are discovered. It like what our agent does, but in situations where it doesn&rsquo;t make sense like when you use Docker or deploy on a PaaS like Heroku.</p>

<p>You can register a new monitor by:</p>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Token YOURTOKENHERE"</span> <span class="se">\</span>
     -X POST -F <span class="nv">file</span><span class="o">=</span>@./Gemfile.lock <span class="se">\</span>
     https://appcanary.com/api/v2/monitors/my-great-app?platform<span class="o">=</span>ruby
</code></pre>

<p>and you&rsquo;ll get a response like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"monitor"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-server"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"56eac124-35c2-49bd-ab02-45de56c03ef4"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>And, you&rsquo;ll be emailed about any vulnerabilities that affect your app as soon as we find out about them!</p>

<p>You can also list, inspect, or delete monitors via the API. More information <a href="https://appcanary.com/docs#create-monitor">here</a>.</p>

<h2>The Server API</h2>

<p>The &ldquo;Server&rdquo; API allows you to navigate the servers you have the Appcanary agent running on via API, and list any vulnerabilities that affect them!</p>

<p>I can see the servers I have agents running on with:
<code>bash
curl -H &quot;Authorization: Token YOURTOKENHERE&quot; \
      https://appcanary.com/api/v2/servers
</code></p>

<p>and you&rsquo;ll get a response like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server1"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55a5baeb-2ad4-4787-8784-a062d254900e"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hostname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server1"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last-heartbeat-at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-03-27T03:33:02.185Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"apps"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
              </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/dpkg/status"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55a5baec-3e5c-4cca-832c-06aaa36418f6"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
              </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/www/myapp/current/Gemfile.lock"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55a5baec-027d-4618-b8de-12638281f34c"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"server2"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"560b0e75-1317-481c-98bb-15e6ae5978b6"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hostname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"database"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"last-heartbeat-at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-03-08T00:21:31.105Z"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"apps"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
              </span><span class="nt">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/var/lib/dpkg/status"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"560b0e77-0a26-41fd-bc35-38b5aac33709"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>You can also inspect or delete any server with an agent on it via the API.</p>

<p>Our API fully supports <strong>Ruby</strong>, <strong>Ubuntu</strong>, and <strong>CentOS 7</strong>! Learn more about how to use it by visiting <a href="https://appcanary.com/docs">the docs page</a>.</p>

<p>You can <a href="https://appcanary.com/sign_up">sign up</a> for Appcanary to use our APIs today!</p>

</section>
<footer class='post-meta'>
<a href='/author/max-veytsman.html'>Max Veytsman</a>
on <a href='/tag/announcements.html'>Announcements</a>, <a href='/tag/product.html'>Product</a>
<time class='post-date' datetime='2016-04-06'>
06 April 2016
</time>
</footer>
</article>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/new-api-centos-support.html">Hello, new Appcanary API and CentOS support!</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>A lot of our users have told us, </p>

<blockquote>
<p>&ldquo;Gosh, I love knowing exactly which packages I have to update in order to keep my apps and servers secure. Have you thought about an API?&rdquo;</p>
</blockquote>

<p>We listened carefully to that feedback, and it is with pride and pleasure that we&rsquo;re announcing our new beta! We&rsquo;re still busy improving it, so we won&rsquo;t charge you for it for now.</p>

<p>Once you <a href="https://appcanary.com/sign_up">sign up</a>, all you have to do is issue a curl:</p>
<pre class="highlight shell"><code>curl -H <span class="s2">"Authorization: Token YOURTOKENHERE"</span> <span class="se">\</span>
     -X POST -F <span class="nv">file</span><span class="o">=</span>@./Gemfile.lock <span class="se">\</span>
     https://appcanary.com/api/v2/check/ruby
</code></pre>

<p>and you&rsquo;ll get a response like:</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"vulnerable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nt">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"artifact-version"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rack"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rubygem"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.6.0"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"vulnerabilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Potential Denial of Service Vulnerability in Rack"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Carefully crafted requests can cause a `SystemStackError` and potentially \ncause a denial of service attack. \n\nAll users running an affected release should upgrade."</span><span class="p">,</span><span class="w">
            </span><span class="nt">"criticality"</span><span class="p">:</span><span class="w"> </span><span class="s2">"high"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"cve"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"CVE-2015-3225"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"osvdb"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nt">"patched-versions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"~&lt; 1.5.4"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"~&lt; 1.4.6"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"&gt;= 1.6.2"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nt">"unaffected-versions"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nt">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"55807540-053f-40f0-9266-a3d1ca6a5838"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"upgrade-to"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="s2">"&gt;= 1.6.2"</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Our API fully supports <strong>Ruby</strong>, <strong>Ubuntu</strong>, and <strong>CentOS 7</strong>! You can learn more about how to use it by visiting <a href="https://appcanary.com/docs">the docs page</a>.</p>

<p>Which reminds us,</p>

<h2>We now support CentOS 7!</h2>

<p>Appcanary now fully supports <strong>CentoOS 7</strong>. If you install our agent on a CentOS 7 server, we will email you notifications whenever any rpm package you have installed on your system has a known vulnerability.</p>

<p>If you&rsquo;re not a current user and want to try out Appcanary&rsquo;s API and/or use us to monitor your CentOS 7 servers, you can <a href="https://appcanary.com/signup">sign up</a>!</p>

<p>You can always let us know what you think at <a href="mailto:hello@appcanary.com">hello@appcanary.com</a>.</p>

</section>
<footer class='post-meta'>
<a href='/author/max-veytsman.html'>Max Veytsman</a>
on <a href='/tag/announcements.html'>Announcements</a>, <a href='/tag/product.html'>Product</a>
<time class='post-date' datetime='2016-03-07'>
07 March 2016
</time>
</footer>
</article>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/slippery-exception-clojure-ruby.html">Slippery exceptions in Clojure and Ruby</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>Recently I spent a couple of hours banging my head against code that looks like this:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">parse-file</span><span class="w">
  </span><span class="p">[</span><span class="n">contents</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">remove</span><span class="w"> </span><span class="nb">nil?</span><span class="w">
          </span><span class="p">(</span><span class="nf">code-that</span><span class="w"> </span><span class="n">throws-an-exception</span><span class="p">)))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">consume-manifest</span><span class="w">
  </span><span class="p">[</span><span class="n">contents</span><span class="w"> </span><span class="n">kind</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">try+</span><span class="w">
    </span><span class="p">(</span><span class="nf">parse-file</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="w">

    </span><span class="p">(</span><span class="nf">catch</span><span class="w"> </span><span class="n">java.lang.Exception</span><span class="w"> </span><span class="n">e</span><span class="w">
      </span><span class="p">(</span><span class="nf">throw+</span><span class="w"> </span><span class="p">{</span><span class="no">:type</span><span class="w"> </span><span class="no">::bad-parse</span><span class="w"> </span><span class="no">:message</span><span class="w"> </span><span class="s">"Invalid file."</span><span class="p">}))))</span><span class="w">

</span><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">check</span><span class="w">
  </span><span class="p">[</span><span class="n">file</span><span class="w"> </span><span class="n">kind</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nf">try+</span><span class="w">
    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">[</span><span class="n">artifacts</span><span class="w"> </span><span class="p">(</span><span class="nf">consume-manifest</span><span class="w"> </span><span class="p">(</span><span class="nb">slurp</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="n">kind</span><span class="p">]</span><span class="w">
      </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">not-empty</span><span class="w"> </span><span class="n">artifacts</span><span class="p">)</span><span class="w">
        </span><span class="err">…</span><span class="w"> </span><span class="n">etc</span><span class="w">
</span></code></pre>

<p>And much to my surprise, I kept getting the kind of exception <code>parse-file</code> generates deep within the <code>check</code> function, right up against <code>(not-empty artifacts)</code>.</p>

<p>I&rsquo;ve grown somewhat used to Clojure exceptions being unhelpful, but this was taking the cake. Coming from Ruby and pretty much every other language, this brushed up rudely against my expectations. </p>

<p>You can tell that exceptions in Clojure are unloved, given how cumbersome handling them natively is. We&rsquo;d had some trouble in the past getting <a href="https://github.com/scgilardi/slingshot">slingshot</a> to behave properly, so I zero&#39;ed in on there. Don&rsquo;t all exceptions in Java descend from <code>Exception</code>?</p>

<p>Stepping through <code>check</code> in the <a href="cursive-ide.com">Cursive</a> debugger, I could see that the exception generated was a pure java exception, not a slingshot exception generated by <code>throw+</code> in <code>consume-manifest</code>. This meant that the exception was slipping straight through uncaught. But calling <code>consume-manifest</code> directly in my repl was causing it to work as intended.</p>

<p>What the hell was going on?</p>

<p><a href="https://twitter.com/mveytsman">Max</a> took one look at it and set me straight. &ldquo;Oh. <a href="https://clojuredocs.org/clojure.core/remove"><code>remove</code></a> is lazy, so the exception isn&rsquo;t being throw until the lazy sequence is accessed.&rdquo;</p>

<p>Excuse me? I had an angry expression on my face. He looked sheepish.</p>

<p>&ldquo;How else would a lazy data structure work?&rdquo;</p>

<p>Well. I would expect a <code>catch java.lang.Exception</code> to <em>catch every exception</em>.</p>

<p>&ldquo;Right, well, hear me out. What if you had the following Ruby?&rdquo;</p>
<pre class="highlight ruby"><code><span class="k">def</span> <span class="nf">lazy_parse</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="nf">each_line</span><span class="p">.</span><span class="nf">each_with_index</span><span class="p">.</span><span class="nf">lazy</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
    <span class="k">raise</span> <span class="s2">"You can't catch me, I'm the exception man"</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">5</span>
    <span class="n">line</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">consume_file</span>
  <span class="k">begin</span>
    <span class="n">lazy_parse</span><span class="p">(</span><span class="s2">"Gemfile.lock"</span><span class="p">)</span>
  <span class="k">rescue</span>
    <span class="nb">puts</span> <span class="s2">"Woops, an exception. Good thing we caught it."</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">file</span> <span class="o">=</span> <span class="n">consume_file</span>
<span class="nb">puts</span> <span class="n">file</span><span class="p">.</span><span class="nf">first</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre>

<p>(Did you know that Ruby has had <a href="http://railsware.com/blog/2012/03/13/ruby-2-0-enumerablelazy/">lazy enumerables</a> for almost four years now? Worth reading <a href="http://patshaughnessy.net/2013/4/3/ruby-2-0-works-hard-so-you-can-be-lazy">Shaughnessy as well</a>.)</p>

<p>That shut me up good. And in case you were wondering, the stack trace is also useless in Ruby; there simply isn&rsquo;t any context for it to preserve. Frankly, I&rsquo;ve just never had to think about lazy data structures in Rubyland; they&rsquo;ve not been super popular. </p>

<p>It&rsquo;s hard to reason about this. I want to write wrapper functions that make my code safe to consume downstream. This isn&rsquo;t feasible for any functions iterating over potentially infinite lazy sequences, but fortunately for us we need to fit this file into memory anyways. In Ruby we&rsquo;d have to forcibly iterate over every element of the sequence and check for exceptions, but Clojure makes this easy with <a href="https://clojuredocs.org/clojure.core/doall"><code>doall</code></a>:</p>
<pre class="highlight clojure"><code><span class="p">(</span><span class="k">defn</span><span class="w"> </span><span class="n">parse-file</span><span class="w">
  </span><span class="p">[</span><span class="n">contents</span><span class="p">]</span><span class="w">
  </span><span class="p">(</span><span class="nb">doall</span><span class="w"> </span><span class="p">(</span><span class="nb">remove</span><span class="w"> </span><span class="nb">nil?</span><span class="w">
                 </span><span class="p">(</span><span class="nf">code-that</span><span class="w"> </span><span class="n">throws-an-exception</span><span class="p">))))</span><span class="w">
</span></code></pre>

<p>And now, things behave as intended.</p>

</section>
<footer class='post-meta'>
<a href='/author/phillip-mendonca-vieira.html'>Phillip Mendonça-Vieira</a>
on <a href='/tag/clojure.html'>Clojure</a>, <a href='/tag/ruby.html'>Ruby</a>, <a href='/tag/programming.html'>Programming</a>, <a href='/tag/bugs.html'>Bugs</a>, <a href='/tag/developer-diary.html'>Developer Diary</a>
<time class='post-date' datetime='2016-02-16'>
16 February 2016
</time>
</footer>
</article>
<article class='post'>
<header class='post-header'>
<h1 class='post-title'><a href="2016/datomic-intro-talk.html">A Gentle Intro to Datomic</a></h1>
<section class='post-meta'>
</section>
</header>
<section class='post-content'>
<p>We use <a href="http://www.datomic.com/">Datomic</a> as one of our datastores, and have been really enjoying it so far.</p>

<p>I gave a talk to my local <a href="http://www.meetup.com/Clojure-Toronto/">Clojure meetup</a> that provided a gentle introduction to Datomic and highlighted some cool features.</p>

<p>The slides are below:</p>

<script async="" class="speakerdeck-embed" data-id="dd426e5c924f44eb9050c554137ae030" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>

</section>
<footer class='post-meta'>
<a href='/author/max-veytsman.html'>Max Veytsman</a>
on <a href='/tag/clojure.html'>Clojure</a>, <a href='/tag/datomic.html'>Datomic</a>, <a href='/tag/programming.html'>Programming</a>, <a href='/tag/talks.html'>Talks</a>
<time class='post-date' datetime='2016-02-09'>
09 February 2016
</time>
</footer>
</article>
<nav class='pagination' role='pagination'>
<span class='page-number'>Page 1 of 2</span>
<a class="older-posts" href="page/2/">Older Posts →</a>
</nav>


</main>

<footer class='site-footer clearfix'>
<section class='copyright'>
<a href='/'>Appcanary</a>
&copy;
2016
</section>
<section class='poweredby'>
</section>
</footer>
</div>
<script src="javascripts/application.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61163522-3', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
