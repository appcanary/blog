<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/stylesheets/application.css" rel="stylesheet" />
    <link href="/images/favicon.ico" rel="icon" type="image/ico" />

      <title>Appcanary - Good News: Ubuntu Now Ships With unattended-upgrades On By Default!</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />
  </head>
  <body>
    <script src="//use.typekit.net/dkz5zwp.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>


    <div class="topbar"></div>
    <div id="header">
      <div class="preamble">
        <a href="https://blog.appcanary.com"><img class="logo" src="/images/appcanary.png" alt="Appcanary logo"></a>
        <p>
          <b><a href="https://appcanary.com">Appcanary</a></b> makes sure you never run vulnerable software on your servers.
          <br/>
          Like our blog? Subscribe to our <a href="https://appcanary.us10.list-manage.com/subscribe?u=303b378f377508300c0b5469a&id=dc58e8f56f">newsletter</a>.<br/>
          Browse the <a href="/archive.html">archive</a>, or follow us on <a href="https://twitter.com/appcanary">twitter</a>, <a href="https://github.com/appcanary">github</a> or <a href="/feed.xml">rss</a>.
        </p>
      </div>
    </div>

      <section>
    <div class="entry">
      <div class="post">
        <h1 class="title"><a href="/2016/unattended-upgrades.html">Good News: Ubuntu Now Ships With unattended-upgrades On By Default!</a></h1>
        <div class="published-tags">By <span class="author"><a href="/author/max-veytsman.html">Max Veytsman</a></span> |
          <span class="date">November 15, 2016</span> on <a href="/tags/clojure.html">Clojure</a>, <a href="/tags/programming.html">Programming</a>, <a href="/tags/ruby.html">Ruby</a></div>

        <p>Last week, we got a strange support request. One of our users had received the following notification:</p>

<blockquote>
<p>Hey! Good job.</p>

<p>We&rsquo;ve detected that you patched some vulnerabilities.</p>

<p>Here&rsquo;s what changed:</p>

<p><a href="https://appcanary.com/vulns/46220">CVE-2016-8704</a></p>

<p>is no longer present in:</p>

<p>[name of server redacted]</p>
</blockquote>

<p>This came as a surprise, since they knew for a fact that no one had touched the package in
question, and they were certain they had not enabled unattended upgrades. </p>

<p>Somehow, the vulnerability magically got patched and they wanted to
know: what&rsquo;s going on?</p>

<p>The vuln is a pretty serious remote code execution vulnerability in <code>memcached</code>,
and as far as we could tell our user was indeed using the most recent version available for their
distribution &mdash; <code>1.4.25-2ubuntu2.1</code>. This version was released on November 3rd, and we could see from our logs that
<code>memcached</code> got upgraded that same day.</p>

<p>How did it happen without them knowing about it? The only thing unique about
their configuration was that they&rsquo;re running the recently released Ubuntu 16.10 (Yakkety
Yak)<sup id="fnref1"><a href="#fn1" rel="footnote">1</a></sup>. </p>

<p>We dug around, and set up some test Yakkety boxes, and
lo and behold: unattended upgrades is automatically enabled by default!</p>

<p>For those of you who are unaware, <code>unattended-upgrades</code> is a debian/ubuntu package that, well, does what it says on the
tin: it automatically upgrades your packages. The most common configuration, and the one enabled in 16.10, is to upgrade any packages that have a published security patch. Unattended upgrades does this by checking and installing any
updates from the <code>${distro_codename}-security</code> repository.</p>

<p>Ubuntu/debian has had this for years, but it simply was never turned on by
default. After a year of many
<a href="https://blog.appcanary.com/2016/vikhal-symantec.html">security</a>
<a href="https://blog.appcanary.com/2016/mirai-botnet-security-broken.html">fails</a>, this
news warmed the cockles of my heart and gave me hope for our future! And what&rsquo;s
even amazing is that they turned it on without any fanfare. </p>

<p>It&rsquo;s the quiet,
simple changes that provide the biggest wins.</p>

<p>Of course, there are reasons why administrators don&rsquo;t always want software to be upgraded without
their input. And if it does get updated, there are good reasons for knowing exactly what vulnerabilities are being patched when.
<a href="https://appcanary.com/?utm_source=blog&amp;utm_medium=web&amp;utm_campaign=unattended">Appcanary</a> exists in order to allow you to be notified
about security updates without automatically installing them, and to have
insight into what&rsquo;s going being installed if you are patching automatically.</p>

<p>But if you don&rsquo;t have the capacity to actively manage the packages on your
linux systems (and even if you do!), we implore you: set up <code>unattended-upgrades</code>!</p>

<p>Ubuntu enabling this by default is a great sign for the future.</p>

<h2 id="not-running-ubuntu-16-10">Not running Ubuntu 16.10?</h2>

<p>Here&rsquo;s how to turn on unattended upgrades</p>

<ul>
<li>Ansible: <a href="https://galaxy.ansible.com/jnv/unattended-upgrades/">jnv.unattended-upgrades</a></li>
<li>Puppet: <a href="https://forge.puppet.com/puppet/unattended_upgrades">puppet/unattended_upgrades</a></li>
<li>Chef: <a href="https://supermarket.chef.io/cookbooks/apt">apt</a></li>
<li><p>If you&rsquo;re using the server interactively: </p>

<p><code>sudo apt-get install unattended-upgrades &amp;&amp; sudo dpkg-reconfigure unattended-upgrades</code></p></li>
<li><p>Set up manually: <code>sudo apt-get install unattended-upgrades</code> and</p>

<ul>
<li><p>In <code>/etc/apt/apt.conf.d/20auto-upgrades</code>:</p>
<pre class="highlight plaintext"><code>APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Unattended-Upgrade "1";
</code></pre></li>
<li><p>In <code>/etc/apt/apt.conf.d/50unattended-upgrades</code></p>
<pre class="highlight plaintext"><code>// Automatically upgrade packages from these (origin, archive) pairs
Unattended-Upgrade::Allowed-Origins {    
// ${distro_id} and ${distro_codename} will be automatically expanded
    "${distro_id} ${distro_codename}-security";
};

// Send email to this address for problems or packages upgrades
// If empty or unset then no email is sent, make sure that you 
// have a working mail setup on your system. The package 'mailx'
// must be installed or anything that provides /usr/bin/mail.
//Unattended-Upgrade::Mail "root@localhost";

// Do automatic removal of new unused dependencies after the upgrade
// (equivalent to apt-get autoremove)
//Unattended-Upgrade::Remove-Unused-Dependencies "false";

// Automatically reboot *WITHOUT CONFIRMATION* if a 
// the file /var/run/reboot-required is found after the upgrade 
//Unattended-Upgrade::Automatic-Reboot "false";
</code></pre></li>
</ul></li>
</ul>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>16.10 is not a Long Term Support release. Regular Ubuntu releases
are supported for 9 months, while April releases on even years (i.e. 14.04,
16.04, etc&hellip;) are designated LTS, and are supported for 5 years. It&rsquo;s thus
more common to see 12.04, 14.04, and 16.04 in use on servers over other
Ubuntu releases. This particular user has a good reason for running 16.10.&nbsp;<a href="#fnref1" rev="footnote">&#8617;</a></p>
</li>

</ol>
</div>


      </div>
    </div>
  </section>


    <script type="text/javascript">
 /* <![CDATA[ */
 var google_conversion_id = 928841383;
 var google_custom_params = window.google_tag_params;
 var google_remarketing_only = true;
 /* ]]> */
</script>

<script type="text/javascript" src="//www.googleadservices.com/pagead/conversion.js">
</script>
<noscript>
    <div style="display:inline;">
        <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/928841383/?value=0&amp;guid=ON&amp;script=0"/>
    </div>
</noscript>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61163522-3', 'auto');
  ga('send', 'pageview');

</script>

<!-- Twitter universal website tag code -->
<script>
 !function(e,n,u,a){e.twq||(a=e.twq=function(){a.exe?a.exe.apply(a,arguments):
                                               a.queue.push(arguments);},a.version='1',a.queue=[],t=n.createElement(u),
                            t.async=!0,t.src='//static.ads-twitter.com/uwt.js',s=n.getElementsByTagName(u)[0],
                            s.parentNode.insertBefore(t,s))}(window,document,'script');
 // Insert Twitter Pixel ID and Standard Event data below
 twq('init','nve06');
 twq('track','PageView');
</script>
<!-- End Twitter universal website tag code -->

<!-- Facebook Pixel Code -->
<script>
 !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                                                             n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
   n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
   t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
                                                                          document,'script','https://connect.facebook.net/en_US/fbevents.js');
 fbq('init', '1378208595579873'); // Insert your pixel ID here.
 fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
            src="https://www.facebook.com/tr?id=1378208595579873&ev=PageView&noscript=1"
          /></noscript>
<!-- DO NOT MODIFY -->
<!-- End Facebook Pixel Code -->

    
  </body>
</html>
